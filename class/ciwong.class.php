<?php
//$ciwong = new ciwong();

//var_dump(json_decode( $ciwong->login(, ), true));
//$ciwong->Step1();
//$ciwong->Step2();
//$ciwong->GetCode();
//echo $ciwong->GetInfo();

//$ciwong->CheckCode("91863", "04C8EA7DFF9E9A57227446C5790A2538A02C75D2");
//$ciwong->reportjson("04C8EA7DFF9E9A57227446C5790A2538A02C75D2", "280522", "AFE7C4367613EC3772741CA3F31D96DA", "p367_t2_l1112_i8_99000000.txt", "1430473185198", "91863");

class ciwong{
  private $access_token, $expires_in, $openid, $refresh_token, $token_type;
  private $schoolId;
  private $compType, $startTime, $examName;
  private $code;
  public function login($userId, $password){
    $url = "http://121.14.117.216/oauth/token?username=$userId&scope=all&client_secret=d299ebe5a0495aef54be6c7d3b599e65&grant_type=password&client_id=100020&password=$password";
    $this->SetUserId($userId);
    $arr = json_decode($this->Get($url), true);
    if(isset($arr["errcode"])){
      return $arr;
      return false;
    }
    $this->SetToken($arr["access_token"], $arr["expires_in"], $arr["openid"], $arr["refresh_token"], $arr["token_type"]);
    return $this->GetSchoolId();
  }
  public function Step1(){
    $url = "http://mp.s.ciwong.com/s?compId=135&client_id=100020&access_token=" . $this->access_token . 
      "&openid=" . $this->openid . "&oauth_version=2.0&scope=all&clientip=10.".rand(0,255).".".rand(0,255).".".rand(0,255).//随机一下IP
      "&expires_in=" . $this->expires_in .
      "&refresh_token=null&token_type=bearer&schoolid=". $this->schoolId;
    //var_dump($url);
    //curl_setopt($this->ch, CURLOPT_HEADER, true);
    $this->Get($url);
    return $url;
  }
  public function Step2(){
    $url = "http://mp.s.ciwong.com/s/random?__biz=100020&sn=" . $this->access_token .
      "&compid=135&clienttype=0&schoolid=" . $this->schoolId . "&scope=all&openid=" . $this->openid .
      "&termtype=null&token_uid=null&oauth_version=2.0&_=" .time();
    //curl_setopt($this->ch, CURLOPT_HEADER, true);
    $arr = json_decode($this->Get($url), true);
    $this-> SetExam($arr["data"]["compType"], $arr["data"]["startTime"], $arr["data"]["examName"]);
    return true;
  }
  public function GetCode(){
    $url = "http://mp.s.ciwong.com/s/GetCode?at=" . $this->access_token ."&time=" . time();
    $this->code = $this->Get($url);
  }
  public function GetInfo(){
    $arr = array(
      "access_token"=>$this->access_token, 
      "openid"=>$this->openid, 
      "schoolId"=>$this->schoolId, 
      "examName"=>$this->examName, 
      "startTime"=>$this->startTime, 
      "code"=>"data:image/png;base64," . base64_encode($this->code)
    );
    //file_put_contents("D:/temp/code.jpg", $this->code);
    return json_encode($arr);
  }
  public function CheckCode($num, $access_token){
    $url = "http://mp.s.ciwong.com/s/CheckCode";
    $arr = json_decode($this->Post($url, array("num"=>$num, "at"=>$access_token)), true);
    if($arr["data"] == true)
      return true;
    else
      return false;
  }
  
  public function reportjson($access_token, $schoolId, $openid, $examName, $startTime, $code){
    $url = "http://mp.s.ciwong.com/s/reportjson";
    $arr = json_decode($this->Post($url, array(
      "__biz"=>100020,
      "sn"=>$access_token,
      "compId"=>135,
      "schoolid"=>$schoolId,
      "scope"=>"all",
      "openid"=>$openid,
      "termtype"=>"null",
      "token_uid"=>"null",
      "oauth_version"=>"2.0",
      "clientType"=>0,
      "cfgTypeCode"=>"A100001",
      "examName"=>$examName,
      "startTime"=>$startTime,
      "randCode"=>$code,
      "userAnswer"=>$this->GetAnswer($examName)
      )), true);
      return $arr["data"]["myScore"];
  }
  
  private function GetAnswer($examName){
$answer["p367_t2_l1112_i2_99000000.txt"] = '[{"id":"634774422478269141","val":"D"},{"id":"634775145605839247","val":"A"},{"id":"634776009863737236","val":"B"},{"id":"634777007703577849","val":"B"},{"id":"634777021231921610","val":"D"},{"id":"634777049094194548","val":"B"},{"id":"634777792519428305","val":"A"},{"id":"634777900544314041","val":"C"},{"id":"950460940484612533","val":"B"},{"id":"950460940484619164","val":"A"},{"id":"950460940484682638","val":"C"},{"id":"634775090595462627","val":"B"},{"id":"634776165302254249","val":"A"},{"id":"634777019602342748","val":"B"},{"id":"634777785843552580","val":"C"},{"id":"634777967559535747","val":"C"},{"id":"950460940484619102","val":"D"},{"id":"634775143628847775","val":"A"},{"id":"634777982262249571","val":"A"},{"id":"950460940484619052","val":"B"},{"id":"634775175419987613","val":"1"},{"id":"634775257241507325","val":"0"},{"id":"634776052410939966","val":"0"},{"id":"634776915901160607","val":"0"},{"id":"634777036122615765","val":"1"},{"id":"634777044849739093","val":"1"},{"id":"634777112707206278","val":"1"},{"id":"634778525285163340","val":"0"},{"id":"640604160000011851","val":"1"},{"id":"950460940484682082","val":"0"},{"id":"634775175242303301","val":"1"},{"id":"634775256757438475","val":"1"},{"id":"634776189365608515","val":"1"},{"id":"634777034343276639","val":"0"},{"id":"634777658655281185","val":"1"},{"id":"634777893266277258","val":"1"},{"id":"634778525189379172","val":"0"},{"id":"634775257757712232","val":"1"},{"id":"634777669706028595","val":"0"},{"id":"950460940484682662","val":"0"},{"id":"950460940484664089","val":"C"},{"id":"950460940484664090","val":"D"},{"id":"950460940484664091","val":"A"},{"id":"950460940484664092","val":"C"},{"id":"950460940484664093","val":"A"},{"id":"950460940484664094","val":"B"},{"id":"950460940484664095","val":"C"},{"id":"950460940484664096","val":"B"},{"id":"950460940484664097","val":"B"},{"id":"950460940484664098","val":"A"}]';
$answer["p367_t2_l1112_i3_99000000.txt"] = '[{"id":"634774418708054519","val":"D"},{"id":"634775153129576462","val":"B"},{"id":"634776021214785173","val":"A"},{"id":"634776871792707134","val":"C"},{"id":"634777046871970645","val":"A"},{"id":"634777078250645759","val":"B"},{"id":"634777792182467714","val":"B"},{"id":"634777971367502435","val":"C"},{"id":"950460940484612534","val":"C"},{"id":"950460940484619168","val":"C"},{"id":"950460940484682629","val":"A"},{"id":"634775149110541403","val":"C"},{"id":"634777019602342748","val":"B"},{"id":"634777794777220271","val":"A"},{"id":"634777970401860739","val":"B"},{"id":"950460940484619084","val":"A"},{"id":"950460940484682609","val":"D"},{"id":"634775151573629729","val":"C"},{"id":"634777967559535747","val":"C"},{"id":"950460940484619173","val":"D"},{"id":"634775175580667895","val":"1"},{"id":"634775256333273730","val":"0"},{"id":"634775955992786617","val":"0"},{"id":"634776916934818422","val":"0"},{"id":"634777034361996672","val":"1"},{"id":"634777035481298638","val":"0"},{"id":"634777060915583311","val":"1"},{"id":"634777677915855015","val":"1"},{"id":"634778524758818416","val":"1"},{"id":"950460940484682284","val":"1"},{"id":"634775176683589833","val":"0"},{"id":"634775257757712232","val":"1"},{"id":"634777036038999618","val":"1"},{"id":"634777112511113934","val":"1"},{"id":"634777893118700999","val":"1"},{"id":"634777941716530356","val":"0"},{"id":"950460940484682661","val":"0"},{"id":"634775257112183098","val":"0"},{"id":"634776189915353480","val":"1"},{"id":"634778523549036291","val":"1"},{"id":"634783046925799882","val":"C"},{"id":"634783046926267887","val":"A"},{"id":"634783046926267891","val":"C"},{"id":"634783046926267895","val":"B"},{"id":"634783046926267899","val":"A"}]';
$answer["p367_t2_l1112_i4_99000000.txt"] = '[{"id":"634774423515358962","val":"B"},{"id":"634775155609668818","val":"B"},{"id":"634776874554379985","val":"A"},{"id":"634777019602342748","val":"B"},{"id":"634777045870136885","val":"B"},{"id":"634777858237663733","val":"C"},{"id":"634777873940339314","val":"C"},{"id":"634777977310332873","val":"B"},{"id":"950460940484612534","val":"C"},{"id":"950460940484619057","val":"B"},{"id":"950460940484682076","val":"A"},{"id":"634775166476803905","val":"B"},{"id":"634777016780921793","val":"B"},{"id":"634777025519589141","val":"C"},{"id":"634777791105129821","val":"B"},{"id":"950460940484619169","val":"A"},{"id":"950460940484681891","val":"D"},{"id":"634775149110541403","val":"C"},{"id":"634777976566211566","val":"C"},{"id":"950460940484619170","val":"C"},{"id":"634775174558398100","val":"0"},{"id":"634775256757438475","val":"1"},{"id":"634776916053416874","val":"0"},{"id":"634777035397526491","val":"1"},{"id":"634777044108425791","val":"1"},{"id":"634777104904384573","val":"1"},{"id":"634777657609299348","val":"1"},{"id":"634777893560649775","val":"0"},{"id":"634778523338279921","val":"1"},{"id":"950460940484682662","val":"0"},{"id":"634775177123354605","val":"1"},{"id":"634775257387835582","val":"1"},{"id":"634777035563354782","val":"1"},{"id":"634777660416368279","val":"1"},{"id":"634777879593321243","val":"1"},{"id":"634778523009899344","val":"1"},{"id":"950460940484682668","val":"0"},{"id":"634775256333273730","val":"0"},{"id":"634776013772480101","val":"1"},{"id":"634778523214259703","val":"1"},{"id":"950460940484664111","val":"A"},{"id":"950460940484664112","val":"D"},{"id":"950460940484664113","val":"C"},{"id":"950460940484664114","val":"B"},{"id":"950460940484664115","val":"A"},{"id":"950460940484664116","val":"B"},{"id":"950460940484664117","val":"C"},{"id":"950460940484664118","val":"A"},{"id":"950460940484664119","val":"D"},{"id":"950460940484664120","val":"C"}]';
$answer["p367_t2_l1112_i5_99000000.txt"] = '[{"id":"634774413903714080","val":"A"},{"id":"634775156438966275","val":"A"},{"id":"634776004681720134","val":"B"},{"id":"634777015447119450","val":"D"},{"id":"634777025519589141","val":"C"},{"id":"634777049094194548","val":"B"},{"id":"634777857157517836","val":"D"},{"id":"634777976885544127","val":"B"},{"id":"950460940484612532","val":"C"},{"id":"950460940484619042","val":"A"},{"id":"950460940484682654","val":"D"},{"id":"634775157013203283","val":"A"},{"id":"634777013663880318","val":"C"},{"id":"634777857534882499","val":"D"},{"id":"634777983268451338","val":"A"},{"id":"950460940484619162","val":"D"},{"id":"950460940484682606","val":"A"},{"id":"634775155609668818","val":"B"},{"id":"634777970401860739","val":"B"},{"id":"950460940484619121","val":"C"},{"id":"634775175500015754","val":"1"},{"id":"634775256757438475","val":"1"},{"id":"634776052174131550","val":"1"},{"id":"634776919010870069","val":"0"},{"id":"634777033471703109","val":"1"},{"id":"634777036038999618","val":"1"},{"id":"634777060982663429","val":"1"},{"id":"634777659754303116","val":"1"},{"id":"634777669902744941","val":"1"},{"id":"950460940484682102","val":"1"},{"id":"634775175419987613","val":"1"},{"id":"634775257757712232","val":"1"},{"id":"634776185431125604","val":"0"},{"id":"634777035929643426","val":"1"},{"id":"634777112863050552","val":"1"},{"id":"634777766825559176","val":"1"},{"id":"634777881029615765","val":"1"},{"id":"634775257387835582","val":"1"},{"id":"634776186231563010","val":"1"},{"id":"634777673124618599","val":"0"},{"id":"950460940484664100","val":"A"},{"id":"950460940484664101","val":"B"},{"id":"950460940484664102","val":"B"},{"id":"950460940484664103","val":"A"},{"id":"950460940484664104","val":"C"},{"id":"950460940484664105","val":"A"},{"id":"950460940484664106","val":"B"},{"id":"950460940484664107","val":"C"},{"id":"950460940484664108","val":"A"},{"id":"950460940484664109","val":"D"}]';
$answer["p367_t2_l1112_i6_99000000.txt"] = '[{"id":"634774416764603105","val":"D"},{"id":"634775164130091783","val":"B"},{"id":"634777020258167900","val":"A"},{"id":"634777049094194548","val":"B"},{"id":"634777078250645759","val":"B"},{"id":"634777791833963101","val":"B"},{"id":"634777847169288293","val":"C"},{"id":"634777883326251799","val":"C"},{"id":"950460940484612535","val":"B"},{"id":"950460940484619142","val":"D"},{"id":"950460940484682603","val":"D"},{"id":"634775160559401512","val":"A"},{"id":"634777013663880318","val":"C"},{"id":"634777794777220271","val":"A"},{"id":"634777983268451338","val":"A"},{"id":"950460940484619130","val":"B"},{"id":"950460940484682267","val":"B"},{"id":"634775149110541403","val":"C"},{"id":"634777974563948050","val":"B"},{"id":"950460940484619085","val":"C"},{"id":"634775174651686264","val":"1"},{"id":"634775257514039804","val":"1"},{"id":"634776186026578650","val":"1"},{"id":"634776917922768158","val":"1"},{"id":"634777034558089017","val":"1"},{"id":"634777115546099265","val":"1"},{"id":"634777168284175894","val":"1"},{"id":"634777984129104850","val":"1"},{"id":"634778525189379172","val":"0"},{"id":"634820528222380002","val":"1"},{"id":"634775176940834284","val":"1"},{"id":"634775257757712232","val":"1"},{"id":"634777036298116073","val":"0"},{"id":"634777115053450399","val":"0"},{"id":"634777670866202633","val":"0"},{"id":"634777880292046470","val":"1"},{"id":"950460940484682662","val":"0"},{"id":"634775256650890288","val":"1"},{"id":"634778524077565219","val":"1"},{"id":"950460940484681903","val":"1"},{"id":"634783046925799882","val":"C"},{"id":"634783046926267887","val":"A"},{"id":"634783046926267891","val":"C"},{"id":"634783046926267895","val":"B"},{"id":"634783046926267899","val":"A"}]';
$answer["p367_t2_l1112_i8_99000000.txt"] = '[{"id":"634774413233224903","val":"B"},{"id":"634775156438966275","val":"A"},{"id":"634776015391138944","val":"B"},{"id":"634776165302254249","val":"A"},{"id":"634777019602342748","val":"B"},{"id":"634777019832599153","val":"D"},{"id":"634777050882113688","val":"C"},{"id":"634777787115734814","val":"A"},{"id":"634777974563948050","val":"B"},{"id":"950460940484612532","val":"C"},{"id":"950460940484619133","val":"C"},{"id":"634775159294239290","val":"B"},{"id":"634777007703577849","val":"B"},{"id":"634777858587572348","val":"D"},{"id":"634777973238413721","val":"B"},{"id":"950460940484619109","val":"C"},{"id":"950460940484682635","val":"A"},{"id":"634775151573629729","val":"C"},{"id":"634777900544314041","val":"C"},{"id":"950460940484619076","val":"A"},{"id":"634775177123354605","val":"1"},{"id":"634775257241507325","val":"0"},{"id":"634776916643565911","val":"0"},{"id":"634777034343276639","val":"0"},{"id":"634777036402012255","val":"1"},{"id":"634777104993460730","val":"1"},{"id":"634777659618894878","val":"1"},{"id":"634777671468051690","val":"1"},{"id":"634777984064520737","val":"0"},{"id":"950460940484682114","val":"0"},{"id":"634775176866422154","val":"1"},{"id":"634775257757712232","val":"1"},{"id":"634776057972349734","val":"1"},{"id":"634777032328845101","val":"1"},{"id":"634777660416368279","val":"1"},{"id":"634778523549036291","val":"1"},{"id":"950460940484682298","val":"1"},{"id":"634775256985510875","val":"1"},{"id":"634777673124618599","val":"0"},{"id":"950460940484682092","val":"1"},{"id":"950460940484398795","val":"C"},{"id":"950460940484398796","val":"C"},{"id":"950460940484398797","val":"B"},{"id":"950460940484398798","val":"A"},{"id":"950460940484398799","val":"A"}]';
$answer["p367_t2_l1112_i11_99000000.txt"] = '[{"id":"634774415971653713","val":"D"},{"id":"634775161092610448","val":"C"},{"id":"634777013663880318","val":"C"},{"id":"634777015152746933","val":"A"},{"id":"634777045114783558","val":"B"},{"id":"634777794777220271","val":"A"},{"id":"634777865427248361","val":"A"},{"id":"634777971367502435","val":"C"},{"id":"950460940484612534","val":"C"},{"id":"950460940484619137","val":"D"},{"id":"950460940484682254","val":"C"},{"id":"634775147262562157","val":"C"},{"id":"634777024510735369","val":"B"},{"id":"634777787115734814","val":"A"},{"id":"634777970401860739","val":"B"},{"id":"950460940484619148","val":"D"},{"id":"950460940484682253","val":"B"},{"id":"634775154507994883","val":"C"},{"id":"634777974020287095","val":"B"},{"id":"950460940484619100","val":"A"},{"id":"634775175242303301","val":"1"},{"id":"634775257241507325","val":"0"},{"id":"634776058180610100","val":"0"},{"id":"634776901099542609","val":"1"},{"id":"634777091307400692","val":"0"},{"id":"634777117795311215","val":"0"},{"id":"634777168654208544","val":"1"},{"id":"634777876933048570","val":"1"},{"id":"634778525285163340","val":"0"},{"id":"950460940484681908","val":"0"},{"id":"634775176940834284","val":"1"},{"id":"634775256757438475","val":"1"},{"id":"634776055216916895","val":"1"},{"id":"634777036533520486","val":"1"},{"id":"634777661479354146","val":"1"},{"id":"634778523214259703","val":"1"},{"id":"950460940484682097","val":"1"},{"id":"634775257757712232","val":"1"},{"id":"634778525189379172","val":"0"},{"id":"950460940484682095","val":"1"},{"id":"634783046925799882","val":"C"},{"id":"634783046926267887","val":"A"},{"id":"634783046926267891","val":"C"},{"id":"634783046926267895","val":"B"},{"id":"634783046926267899","val":"A"}]';
$answer["p367_t2_l1112_i12_99000000.txt"] = '[{"id":"634774432905639456","val":"D"},{"id":"634775144837693898","val":"A"},{"id":"634776019556034260","val":"B"},{"id":"634776162463205263","val":"B"},{"id":"634777013663880318","val":"C"},{"id":"634777015705611904","val":"C"},{"id":"634777046871970645","val":"A"},{"id":"634777789994251870","val":"C"},{"id":"634777971367502435","val":"C"},{"id":"950460940484612533","val":"B"},{"id":"950460940484619079","val":"C"},{"id":"634775145605839247","val":"A"},{"id":"634777023339641312","val":"A"},{"id":"634777857157517836","val":"D"},{"id":"640604160000002934","val":"C"},{"id":"950460940484619104","val":"D"},{"id":"950460940484682607","val":"D"},{"id":"634775159735252064","val":"A"},{"id":"634777976000710573","val":"C"},{"id":"950460940484619086","val":"A"},{"id":"634775176519945545","val":"1"},{"id":"634775257112183098","val":"0"},{"id":"634776901099542609","val":"1"},{"id":"634776919010870069","val":"0"},{"id":"634777034361996672","val":"1"},{"id":"634777059174620253","val":"0"},{"id":"634777660294376064","val":"1"},{"id":"634778525285163340","val":"0"},{"id":"634778610728385413","val":"1"},{"id":"950460940484682680","val":"1"},{"id":"634775175663348041","val":"1"},{"id":"634775256985510875","val":"1"},{"id":"634776057527436953","val":"0"},{"id":"634777036298116073","val":"0"},{"id":"634777112976150751","val":"1"},{"id":"634777670866202633","val":"0"},{"id":"950460940484682296","val":"1"},{"id":"634775256170721444","val":"0"},{"id":"634778525189379172","val":"0"},{"id":"950460940484682099","val":"1"},{"id":"950460940484664133","val":"C"},{"id":"950460940484664134","val":"A"},{"id":"950460940484664135","val":"C"},{"id":"950460940484664136","val":"C"},{"id":"950460940484664137","val":"B"},{"id":"950460940484664138","val":"B"},{"id":"950460940484664139","val":"D"},{"id":"950460940484664140","val":"A"},{"id":"950460940484664141","val":"A"},{"id":"950460940484664142","val":"D"}]';
$answer["p367_t2_l1112_i13_99000000.txt"] = '[{"id":"634774340416821008","val":"C"},{"id":"634775155058675850","val":"C"},{"id":"634775929155591480","val":"B"},{"id":"634776897826188860","val":"C"},{"id":"634777013088863308","val":"C"},{"id":"634777046212089486","val":"B"},{"id":"634777792182467714","val":"B"},{"id":"634777973633094415","val":"B"},{"id":"950460940484612536","val":"B"},{"id":"950460940484619071","val":"C"},{"id":"950460940484682640","val":"B"},{"id":"634775160559401512","val":"A"},{"id":"634777025519589141","val":"C"},{"id":"634777787115734814","val":"A"},{"id":"634777971367502435","val":"C"},{"id":"950460940484619178","val":"A"},{"id":"950460940484682079","val":"C"},{"id":"634775166092731231","val":"C"},{"id":"634777982262249571","val":"A"},{"id":"950460940484619098","val":"A"},{"id":"634775174730466402","val":"0"},{"id":"634775257640868026","val":"0"},{"id":"634776057527436953","val":"0"},{"id":"634776914118389475","val":"0"},{"id":"634777034343276639","val":"0"},{"id":"634777036402012255","val":"1"},{"id":"634777057252072877","val":"0"},{"id":"634777090458135200","val":"1"},{"id":"634777941716530356","val":"0"},{"id":"950460940484682675","val":"0"},{"id":"634775177054558484","val":"0"},{"id":"634775256650890288","val":"1"},{"id":"634776055715181770","val":"1"},{"id":"634776188351606734","val":"1"},{"id":"634777032412149247","val":"1"},{"id":"634777659754303116","val":"1"},{"id":"634778523338279921","val":"1"},{"id":"634775257112183098","val":"0"},{"id":"634778523009899344","val":"1"},{"id":"950460940484682114","val":"0"},{"id":"950460940484398725","val":"C"},{"id":"950460940484398726","val":"A"},{"id":"950460940484398727","val":"C"},{"id":"950460940484398728","val":"B"},{"id":"950460940484398729","val":"C"}]';
$answer["p367_t2_l1112_i14_99000000.txt"] = '[{"id":"634774414545499208","val":"A"},{"id":"634775160559401512","val":"A"},{"id":"634776871792707134","val":"C"},{"id":"634777052190019985","val":"C"},{"id":"634777067109262190","val":"B"},{"id":"634777857157517836","val":"D"},{"id":"634777861352677205","val":"D"},{"id":"634777977611413402","val":"B"},{"id":"950460940484612532","val":"C"},{"id":"950460940484619133","val":"C"},{"id":"950460940484682037","val":"A"},{"id":"634775151573629729","val":"C"},{"id":"634777013088863308","val":"C"},{"id":"634777791105129821","val":"B"},{"id":"634777973238413721","val":"B"},{"id":"950460940484619051","val":"B"},{"id":"950460940484682075","val":"A"},{"id":"634775157685252464","val":"B"},{"id":"634777016780921793","val":"B"},{"id":"950460940484619155","val":"B"},{"id":"634775174919850735","val":"1"},{"id":"634775256650890288","val":"1"},{"id":"634776901099542609","val":"1"},{"id":"634776917069758659","val":"1"},{"id":"634777057840661910","val":"1"},{"id":"634777114085468699","val":"0"},{"id":"634777168284175894","val":"1"},{"id":"634777669706028595","val":"0"},{"id":"634777909481413738","val":"1"},{"id":"950460940484682682","val":"1"},{"id":"634775175168203171","val":"1"},{"id":"634775257514039804","val":"1"},{"id":"634777032412149247","val":"1"},{"id":"634777114776393913","val":"1"},{"id":"634777880292046470","val":"1"},{"id":"634778525285163340","val":"0"},{"id":"950460940484682084","val":"1"},{"id":"634775257241507325","val":"0"},{"id":"634777669902744941","val":"1"},{"id":"950460940484682278","val":"1"},{"id":"950460940484398851","val":"C"},{"id":"950460940484398852","val":"A"},{"id":"950460940484398853","val":"C"},{"id":"950460940484398854","val":"B"},{"id":"950460940484398855","val":"C"}]';
$answer["p367_t2_l1112_i15_99000000.txt"] = '[{"id":"634774413903714080","val":"A"},{"id":"634775146667421112","val":"B"},{"id":"634777004826152795","val":"C"},{"id":"634777007703577849","val":"B"},{"id":"634777052190019985","val":"C"},{"id":"634777858237663733","val":"C"},{"id":"634777934143653055","val":"A"},{"id":"634777983268451338","val":"A"},{"id":"950460940484612535","val":"B"},{"id":"950460940484619154","val":"C"},{"id":"950460940484681889","val":"D"},{"id":"634775148312132001","val":"C"},{"id":"634776166214387852","val":"C"},{"id":"634777024510735369","val":"B"},{"id":"634777794777220271","val":"A"},{"id":"634777982860042621","val":"D"},{"id":"950460940484619052","val":"B"},{"id":"634775144837693898","val":"A"},{"id":"634777900544314041","val":"C"},{"id":"950460940484619085","val":"C"},{"id":"634775175093479040","val":"1"},{"id":"634775256170721444","val":"0"},{"id":"634776917069758659","val":"1"},{"id":"634777035630122900","val":"1"},{"id":"634777037639250428","val":"0"},{"id":"634777058676511378","val":"1"},{"id":"634777658655281185","val":"1"},{"id":"634777877248169124","val":"1"},{"id":"634778523009899344","val":"1"},{"id":"950460940484682297","val":"1"},{"id":"634775174919850735","val":"1"},{"id":"634775257757712232","val":"1"},{"id":"634776052410939966","val":"0"},{"id":"634777034428140788","val":"1"},{"id":"634777660947549212","val":"1"},{"id":"634777766401550432","val":"1"},{"id":"950460940484682282","val":"0"},{"id":"634775256757438475","val":"1"},{"id":"634777669706028595","val":"0"},{"id":"950460940484682111","val":"1"},{"id":"634783046925799882","val":"C"},{"id":"634783046926267887","val":"A"},{"id":"634783046926267891","val":"C"},{"id":"634783046926267895","val":"B"},{"id":"634783046926267899","val":"A"}]';

    return $answer[$examName];
  }
  
  private function GetSchoolId(){
    if(!isset($this->access_token)&&!isset($this->openid)&&!isset($this->userId)){
      echo "还没登陆";
      return false; 
    }
    $url = "http://api.xixin61.com/v2/school/get_my_school?client_id=100020&access_token=" . $this->access_token .
      "&openid=" . $this->openid . "&oauth_version=2.0&scope=all&clientip=10.0.2.15&termtype=5&userId=" . $this->userId;
    $arr = json_decode($this->Get($url), true);
    if($arr["errcode"]!=0 && !isset($arr["data"][0]["schoolId"])){
      var_dump($arr);
      return false;
    }
    $this->schoolId = $arr["data"][0]["schoolId"];
    return true;
  }
  private function NewCurl(){//新建Curl服务
    $this->ch = curl_init(); 
    curl_setopt($this->ch, CURLOPT_RETURNTRANSFER, true);
    curl_setopt($this->ch, CURLOPT_USERAGENT, "Mozilla/5.0 (Linux; Android 4.4.4; en-us; Nexus 4 Build/JOP40D) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/42.0.2307.2 Mobile Safari/537.36");//设置手机端
    
  }
  private function Get($url){
    if(!isset($this->ch)) $this->NewCurl();
    curl_setopt($this->ch, CURLOPT_URL, $url);
    curl_setopt($this->ch, CURLOPT_POST, false);
    $r = curl_exec ($this->ch);
    return $r;
  }
  private function Post($url, $postArr){
    if(!isset($this->ch)) $this->NewCurl();
    curl_setopt($this->ch, CURLOPT_URL, $url);
    curl_setopt($this->ch, CURLOPT_POST, true);
    $postData = array();
    foreach($postArr as $key => $value){
      array_push($postData, $key . "=" . urlencode($value));
    }
    curl_setopt($this->ch, CURLOPT_POSTFIELDS, join($postData, "&"));
    $r = curl_exec ($this->ch);
    return $r;
  }
  private function SetToken($access_token, $expires_in, $openid, $refresh_token, $token_type){
    $this->access_token = $access_token;
    $this->expires_in = $expires_in;
    $this->openid = $openid;
    $this->refresh_token = $refresh_token;
    $this->token_type = $token_type;
  }
  private function SetUserId($userId){
    $this->userId = $userId;
  }
  private function SetExam($compType, $startTime, $examName){
    $this->compType = $compType;
    $this->startTime = $startTime;
    $this->examName = $examName;
  }
}


function workanswer($str){
  $arr = explode("*", $str);
  $r = array();
  for($i = 0; $i < count($arr); ++$i){
    $arr1 = explode("|", $arr[$i]);
    //var_dump($arr1);
    array_push($r, '{"id":"' . $arr1[0] . '","val":"' . $arr1[3] . '"}');
  }
  return "[". join($r, ","). "]";
}
?>